<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Create Template</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        .pill--removable { cursor: pointer; position: relative; padding-right: 1.4rem; }
        .pill--removable .remove {
            position: absolute;
            right: .45rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: .75rem;
            color: var(--text-dim);
            line-height: 1;
        }
        .pill--removable:hover { border-color: var(--accent); }
        .pill--removable:hover .remove { color: var(--accent-hi); }
    </style>
</head>
<body>

<nav class="nav">
    <span class="nav__logo">⚡ Workout Logger</span>
    <div class="nav__links">
        <a href="/">Home</a>
        <a href="/templates" class="active">Templates</a>
        <a href="/workout-history">History</a>
    </div>
</nav>

<div class="page">

    <div class="page-header">
        <h1>Create Template</h1>
        <p>Give it a name and add the exercises.</p>
    </div>

    <!-- Error banner (shown if controller sets ${error}) -->
    <div th:if="${error}" class="error-banner" th:text="${error}"></div>

    <form action="/templates/create" method="post" id="template-form" class="card">

        <div class="form-group">
            <label for="name">Template name</label>
            <input type="text" id="name" name="name" class="input" placeholder="e.g. Push Day" required th:value="${name}">
        </div>

        <div class="form-group">
            <label>Exercises</label>
            <!-- exercise pills rendered here by JS -->
            <div id="exerciseList" style="margin-bottom:.6rem; min-height:1.8rem;"></div>

            <div class="input-row">
                <input type="text" id="exerciseInput" class="input" placeholder="e.g. Bench Press">
                <button type="button" id="addExercise" class="btn btn--secondary">+ Add</button>
            </div>
        </div>

        <!-- Hidden: comma-separated list sent to server -->
        <input type="hidden" name="exerciseNames" id="exerciseNames">

        <div class="btn-row" style="margin-top:1.5rem;">
            <button type="submit" class="btn btn--primary">Create Template</button>
            <a href="/templates" class="btn btn--ghost">Cancel</a>
        </div>
    </form>

</div>

<script>
(function () {
    const exerciseInput  = document.getElementById('exerciseInput');
    const addButton      = document.getElementById('addExercise');
    const listEl         = document.getElementById('exerciseList');
    const hiddenInput    = document.getElementById('exerciseNames');

    let exercises = [];

    // --- pre-populate if server echoed back (error-recovery)
    const preVal = hiddenInput.value;
    if (preVal && preVal.trim()) {
        preVal.split(',').forEach(n => { n = n.trim(); if (n) add(n); });
    }

    function renderPills() {
        listEl.innerHTML = '';
        exercises.forEach((name, i) => {
            const pill = document.createElement('span');
            pill.className = 'pill pill--removable';
            pill.innerHTML = name + '<span class="remove">✕</span>';
            pill.querySelector('.remove').onclick = () => { exercises.splice(i, 1); sync(); renderPills(); };
            listEl.appendChild(pill);
        });
    }

    function sync() { hiddenInput.value = exercises.join(','); }

    function add(name) {
        name = name.trim();
        if (!name) return;
        exercises.push(name);
        sync();
        renderPills();
        exerciseInput.value = '';
        exerciseInput.focus();
    }

    addButton.addEventListener('click', () => add(exerciseInput.value));
    exerciseInput.addEventListener('keypress', e => { if (e.key === 'Enter') { e.preventDefault(); add(exerciseInput.value); } });

    document.getElementById('template-form').addEventListener('submit', () => sync());
})();
</script>

</body>
</html>
