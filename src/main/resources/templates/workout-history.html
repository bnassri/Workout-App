<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Workout History</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<nav class="nav">
    <span class="nav__logo">âš¡ Workout Logger</span>
    <div class="nav__links">
        <a href="/">Home</a>
        <a href="/templates">Templates</a>
        <a href="/workout-history" class="active">History</a>
    </div>
</nav>

<div class="page page--wide">

    <div class="page-header" style="display:flex; justify-content:space-between; align-items:flex-end;">
        <div>
            <h1>History</h1>
            <p>All past workouts.</p>
        </div>
        <a href="/" class="btn btn--primary">+ New Workout</a>
    </div>

    <!-- empty state -->
    <div th:if="${sessions.isEmpty()}" class="empty">
        <div class="empty__icon">ðŸ“Š</div>
        <p>No workouts logged yet. Start one from the home page!</p>
        <a href="/" class="btn btn--primary" style="margin-top:1rem;">Go to Home</a>
    </div>

    <!-- history table -->
    <div th:if="${!sessions.isEmpty()}" class="card" style="padding:0; overflow:hidden;">
        <table class="table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Duration</th>
                    <th>Sets</th>
                    <th>Volume</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="s : ${sessions}">
                    <td>
                        <span class="start" th:attr="data-millis=${s.startMillis}" style="font-weight:600;">N/A</span>
                        <span class="end" th:attr="data-millis=${s.endMillis}" style="display:none;"></span>
                    </td>
                    <td class="duration" style="color:var(--text-dim);">N/A</td>
                    <td th:text="${s.totalSets}" style="font-weight:600;">0</td>
                    <td>
                        <span th:text="${s.totalVolume}" style="font-weight:600;"></span>
                        <span style="color:var(--text-dim); font-size:.82rem;">lbs</span>
                    </td>
                    <td>
                        <a th:href="@{'/workout-sessions/' + ${s.id} + '/summary'}" class="btn btn--ghost" style="padding:.35rem .7rem; font-size:.82rem;">Details â†’</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

</div>

<!-- ============================================================
     Timestamp formatting â€” same logic as original, untouched
     ============================================================ -->
<script th:inline="javascript">
const rows = document.querySelectorAll('tbody tr');

rows.forEach(row => {
    const startEl = row.querySelector('.start');
    const endEl   = row.querySelector('.end');
    const durationEl = row.querySelector('.duration');

    const startMillis = parseInt(startEl.dataset.millis, 10);
    const endMillis   = parseInt(endEl.dataset.millis, 10);

    function formatDate(ms) {
        if (!ms) return "N/A";
        const d = new Date(ms);
        return isNaN(d.getTime()) ? "â€”" : d.toLocaleDateString('en-US', {
            weekday: 'short', month: 'short', day: 'numeric',
            hour: '2-digit', minute: '2-digit'
        });
    }

    startEl.innerText = formatDate(startMillis);

    if (startMillis && endMillis) {
        const diffMs = endMillis - startMillis;
        const totalSeconds = Math.floor(diffMs / 1000);
        const hours   = Math.floor(totalSeconds / 3600);
        const minutes = Math.floor((totalSeconds % 3600) / 60);
        const seconds = totalSeconds % 60;
        durationEl.innerText =
            `${String(hours).padStart(2,"0")}:${String(minutes).padStart(2,"0")}:${String(seconds).padStart(2,"0")}`;
    } else {
        durationEl.innerText = "â€”";
    }
});
</script>

</body>
</html>
