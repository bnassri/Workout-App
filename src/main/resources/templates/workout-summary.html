<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Workout Summary</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<nav class="nav">
    <span class="nav__logo">âš¡ Workout Logger</span>
    <div class="nav__links">
        <a href="/">Home</a>
        <a href="/templates">Templates</a>
        <a href="/workout-history">History</a>
    </div>
</nav>

<div class="page">

    <div class="page-header" style="text-align:center;">
        <h1>ðŸŽ‰ Workout Complete</h1>
        <p>Here's how it went.</p>
    </div>

    <!-- top-line stats -->
    <div class="stats">
        <div class="stat">
            <div class="stat__label">Duration</div>
            <div class="stat__value" th:text="${summary.durationSeconds != null ?
                T(java.lang.String).format('%02d:%02d',
                    (summary.durationSeconds % 3600) / 60,
                    summary.durationSeconds % 60)
                : 'N/A'}">00:00</div>
            <div class="stat__unit">min : sec</div>
        </div>
        <div class="stat">
            <div class="stat__label">Total Sets</div>
            <div class="stat__value" th:text="${summary.totalSets}">0</div>
        </div>
        <div class="stat">
            <div class="stat__label">Volume</div>
            <div class="stat__value" th:text="${#numbers.formatDecimal(summary.totalVolume, 0, 0)}">0</div>
            <div class="stat__unit">lbs</div>
        </div>
    </div>

    <!-- time range -->
    <div class="card" style="display:flex; justify-content:space-between; font-size:.88rem; color:var(--text-dim);">
        <span>
            <strong style="color:var(--text);">Started</strong>
            <span th:text="${summary.startTime != null ? #temporals.format(summary.startTime, 'HH:mm') : 'â€”'}"> </span>
        </span>
        <span style="color:var(--border);">â†’</span>
        <span>
            <strong style="color:var(--text);">Finished</strong>
            <span th:text="${summary.endTime != null ? #temporals.format(summary.endTime, 'HH:mm') : 'â€”'}"> </span>
        </span>
    </div>

    <!-- ========== COMPARISON (only if controller sets hasComparison=true) ========== -->
    <div th:if="${hasComparison}" class="compare">
        <div class="compare__header">ðŸ“Š vs Last Workout</div>

        <div class="compare__totals">
            <div>
                <div class="label">Previous</div>
                <div class="value" th:text="${#numbers.formatDecimal(comparison.previousTotalVolume, 0, 0)}">0</div>
                <div class="unit">lbs</div>
            </div>
            <div>
                <div class="label">This Time</div>
                <div class="value" th:text="${#numbers.formatDecimal(comparison.currentTotalVolume, 0, 0)}">0</div>
                <div class="unit">lbs</div>
            </div>
            <div>
                <div class="label">Change</div>
                <div class="value delta"
                     th:classappend="${comparison.totalDelta > 0 ? 'delta--up' : (comparison.totalDelta < 0 ? 'delta--down' : 'delta--zero')}"
                     th:text="${(comparison.totalDelta > 0 ? '+' : '') + #numbers.formatDecimal(comparison.totalDelta, 0, 0)}">0</div>
                <div class="unit">lbs</div>
            </div>
        </div>

        <div class="compare__exercises">
            <div th:each="ex : ${comparison.exercises}" class="compare__row">
                <div class="compare__row__name" th:text="${ex.exercise}">Exercise</div>
                <div class="compare__row__nums">
                    <div class="vol">
                        <div class="label">Prev</div>
                        <div class="value" th:text="${#numbers.formatDecimal(ex.previousVolume, 0, 0)}">0</div>
                    </div>
                    <div class="vol">
                        <div class="label">Now</div>
                        <div class="value" th:text="${#numbers.formatDecimal(ex.currentVolume, 0, 0)}">0</div>
                    </div>
                    <div class="delta"
                         th:classappend="${ex.delta > 0 ? 'delta--up' : (ex.delta < 0 ? 'delta--down' : 'delta--zero')}"
                         th:text="${(ex.delta > 0 ? '+' : '') + #numbers.formatDecimal(ex.delta, 0, 0)}">0</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ========== Exercise breakdown ========== -->
    <div class="card">
        <h3 style="font-size:.82rem; text-transform:uppercase; letter-spacing:.6px; color:var(--text-dim); margin-bottom:.85rem;">Exercises</h3>

        <div th:if="${!summary.exercises.isEmpty()}">
            <div th:each="ex : ${summary.exercises}"
                 style="display:flex; justify-content:space-between; align-items:center; padding:.6rem 0; border-bottom:1px solid var(--border);">
                <span style="font-weight:600;" th:text="${ex.name}">Name</span>
                <span style="color:var(--text-dim); font-size:.88rem;">
                    <span th:text="${ex.sets}">0</span> sets Â·
                    <span th:text="${#numbers.formatDecimal(ex.volume, 0, 0)}">0</span> kg
                </span>
            </div>
        </div>

        <div th:if="${summary.exercises.isEmpty()}" style="color:var(--text-dim); font-size:.9rem; padding:.4rem 0;">
            No exercises recorded.
        </div>
    </div>

    <!-- actions -->
    <div class="btn-row">
        <a href="/" class="btn btn--primary">âš¡ Start New Workout</a>
        <a href="/workout-history" class="btn btn--secondary">ðŸ“Š View History</a>
    </div>

</div>

</body>
</html>
